<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>FullScreen</title>
	<!-- <link rel="stylesheet" type="text/css" href="../css/echarts.css" /> -->
    <link rel="stylesheet" type="text/css" href="../css/detail.css">
</head>
<body class="full-screen">
    <!-- 头部开始 -->
    <div class="f-header">
        <div class="fh-logo"><img src="../img/logo.png"></div>
        <div class="fh-time"><div class="fh-date">2017/1/1</div><div class="fh-minute">12:34</div></div>
    </div>
    <!-- 头部结束 -->
        
	<div class="content">  
        <div class="container  full-screen-container">
            <div class="f-lineType">
                <div class="flt-text">
                    <img src="../img/线形.png"><span class="fl-text">Line</span><span class="fl-trangle"></span>
                </div>
                <div class="f-lineType-box">
                    <span class="fl-trangle flb-tragle"></span>
                    <span class="fl-trangle flb-tragle2"></span>
                    <ul class="flb-toggle">
                        <li class="active"><img src="../img/线形.png"><span class="fl-text">Line</span></li>
                        <li><img src="../img/面积.png"><span class="fl-text">Area</span></li>
                    </ul>
                </div>
            </div>
            <div class="f-search">
                <input type="text" class="fs-text" value="">
                <input type="button">
                <ul id="url_list">
                </ul>
            </div>
        </div>

        <ul class="f-legend">
            
        </ul>
        <div id="kline_charts" class="fl f-kline-charts">
            
        </div>
        
        <!-- 右侧信息框开始 -->
        <div class="fr f-stockInfo">
            <!-- <div class="no-data no-data-k" id="withoutStockData"></div> -->
            <div class="f-tb-fieldName">
                <div class="tb-fn-title f-tbfn-title">-</div>
                <div class="tb-fn-num f-tbfn-num">
                    <span>-</span>
                    <span>-</span>
                    <span>-</span>
                </div>
            </div>
            <ul class="tb-fielList f-tb-fielList">
                <li><p>最高：</p><span class="red">-</span></li>
                <li><p>今开：</p><span class="green">-</span></li>
                <li><p>最低：</p><span class="green">-</span></li>
                <li><p>昨收：</p><span>-</span></li>

                <li><p>成交额：</p><span>-</span></li>
                <li><p>市盈率：</p><span>-</span></li>
                <li><p>成交量：</p><span>-</span></li>
                <li><p>市&nbsp;&nbsp;&nbsp;&nbsp;值：</p><span>-</span></li>
                <li><p>换手率：</p><span>-</span></li>
                <li><p>振&nbsp;&nbsp;&nbsp;&nbsp;幅：</p><span>-</span></li>
            </ul>
            <div class="f-latest-stock">
                <h2>最近访问股</h2>
                <ul class="f-ls-list">
                    <li><span>新华传媒</span><span>6.04</span><span class="black">0.00%</span></li>
                    <li><span>新华传媒</span><span>6.04</span><span class="red">0.00%</span></li>
                    <li><span>新华传媒</span><span>6.04</span><span class="green">0.00%</span></li>
                    <li><span>新华传媒</span><span>6.04</span><span class="black">0.00%</span></li>
                    <li><span>新华传媒</span><span>6.04</span><span class="black">0.00%</span></li>
                </ul>
            </div>
        </div>
        <!-- 右侧信息框结束 -->
        
    </div>
	
    

	<script src="../js/jquery.js"></script>
	<script src="../js/highstock.js"></script>
	<script src="../js/moment.min.js"></script>
	<script src="../js/public.js"></script> 

    <script src="../js/kLineHighCharts.js"></script>
    <script type="text/javascript">


        $(function(){
			// 行情echarts切换标签
            $(".container").toggleLi(
                {
                    data:[
                        {name:"分时",id:"mline"},
                        {name:"日K",id:"day"},
                        {name:"分钟",id:"minute"}
                    ],
                    width:'120px',
                    lineHeight: '60px'
                }
            );
            var wsUrl, stockXMlUrl;
            wsUrl = "ws://103.66.33.67:443";
            stockXMlUrl = "http://172.17.20.203:6789/2";
            //指数与个股区分
            var url = location.href;
            var id, exchangeID, wsUrl, stockXMlUrl;
            if(url.indexOf("?")>-1){
                id = getQueryString("id");//main.js里的getQueryString
                exchangeID = getQueryString("exchangeID");
            }else{
                id = "1";
                exchangeID = "101";
            }
            var wsUrl, stockXMlUrl;
            switch(exchangeID){
                case "2":
                    // 深交所接口
                    wsUrl = "ws://103.66.33.67:443";
                    stockXMlUrl = "http://172.17.20.203:6789/2";
                    break;
                case "101":;
                default: 
                    // 上证指数接口
                    wsUrl = "ws://172.17.20.203:7681";
                    stockXMlUrl = "http://172.17.20.203:6789/101";
            }

            // 初始化K线图
            $.queryKLine({
                InstrumentID: id,
                ExchangeID: exchangeID,
                wsUrl:wsUrl,
                stockXMlUrl:stockXMlUrl
            });
            
            $.queryStockInfo({
                InstrumentID: id,
                ExchangeID: exchangeID,
                wsUrl:wsUrl,
                stockXMlUrl:stockXMlUrl
            });

        }); 

        /*
         * 查询下拉框效果
         */
        $(".fs-text").focus(function(){
            $(".fs-text").keyup();
        });
        var timer;
        $(".fs-text").keyup(function(){

            // 连续按键会清除查询
            clearTimeout(timer);

            // 点击回车
            $("body").keydown(function() {
                if (event.keyCode == "13") {//keyCode=13是回车键
                    if($("#url_list li").length>0){
                        queryNew($("#url_list li:eq(0)")[0]);
                    }
                }
            });
            $(".f-search input:eq(1)").click(function() {
                if($("#url_list li").length>0){
                    queryNew($("#url_list li:eq(0)")[0]);
                }
            });

            // 查询输入的值
            var value = $(this).val(); 
            // Code是不为空的数字时，进行查询
            if((/^[0-9]*$/gi).test(value)&&value!=""&&value!=null){
                timer = setTimeout(function(){
                    var url = "http://103.66.33.58:443/?ExchangeID=0&Codes="+value;
                    $.ajax({
                        url:  url,
                        type: 'GET',
                        dataType: 'json',
                        async:false,
                        cache:false,
                        error: function(data){
                            console.log("请求代码表出错");
                        },
                        success: function(data){
                            var dataArr = data.CodeInfo;

                            if(dataArr){
                                setSearchUlOptions(dataArr,value);
                                $("#url_list").show();
                            }else{
                                $("#url_list").hide();
                            }
                            
                        }
                    });
                },300);
            }else{
                $("#url_list").hide();
            }
        });

        // 查询的数据，拼接后放入ul中
        var setSearchUlOptions = function(data,value){
            var html = "";       
            $.each(data,function(i,dataObj){
                var spanName = "<span>"+dataObj.InstrumentName+"</span>",
                    spanCode = "<span>"+dataObj.InstrumentCode+"</span>";
                // 是否有值，如果没有输入值，不进行匹配
                if(eval("/"+value+"/").test(spanName)||eval("/"+value+"/").test(spanCode)){
                    spanName = spanName.replace(eval("/"+value+"/"),"<i>"+value+"</i>");
                    spanCode = spanCode.replace(eval("/"+value+"/"),"<i>"+value+"</i>");
                };
                html += "<li eId="+dataObj.ExchangeID+">"+spanName+spanCode+"</li>";
            });
            $("#url_list").html(html);


            // 点击选择了某个选项后 更新输入框内容 打开新页面查询新数据
            $("#url_list li").click(function(){
                queryNew(this);
            });

            // 点击其他地方，关闭菜单
            $(document).click(function(){
                $("#url_list").hide();
            });
            $("#url_list,.fs-text").click(function(event){
                event.stopPropagation();
            });
        };
        function queryNew(eleLi){
            var exchangeID = $(eleLi).attr("eid");
            var id = Number($(eleLi).children("span:eq(1)").text());
            $(".fs-text").val($(eleLi).children("span:eq(1)").text());
            $("#url_list").hide();
            // 打开新页面
            var location = window.location.href.split("?")[0];
            window.location.href = location+"?id="+id+"&exchangeID="+exchangeID;
        }

        /*
         * 分时图的下拉选择 线还是区域
         */
        $(".f-lineType").click(function(){
            
            if($(".f-lineType-box").hasClass("clicked")){
                $(".f-lineType-box").removeClass("clicked");
                $(".f-lineType-box").hide();
            }else{
                $(".f-lineType-box").addClass("clicked")
                $(".f-lineType-box").show();
            }
        });
        $(".flb-toggle").on("click","li",function(){
            var html = "<span class=\"fl-trangle\"></span>";
            html = $(this).html()+html;
            $(".flt-text").html(html);
            // $(this).parent().toggle();
        });
    </script>
</body>
</html>